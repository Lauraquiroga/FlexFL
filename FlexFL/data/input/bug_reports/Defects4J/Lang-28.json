{
    "title": "StringEscapeUtils.escapeXML() can't process UTF-16 supplementary characters",
    "description": "\n\nSupplementary characters in UTF-16 are those whose code points are above 0xffff, that is, require more than 1 Java char to be encoded, as explained here: http://java.sun.com/developer/technicalArticles/Intl/Supplementary/\nCurrently, StringEscapeUtils.escapeXML() isn't aware of this coding scheme and treats each char as one character, which is not always right.\nA possible solution in class Entities would be:\n    public void escape(Writer writer, String str) throws IOException {\n        int len = str.length();\n        for (int i = 0; i < len; i++) {\n            int code = str.codePointAt;\n            String entityName = this.entityName(code);\n            if (entityName != null) \n{\n                writer.write('&');\n                writer.write(entityName);\n                writer.write(';');\n            }\n else if (code > 0x7F) \n{\n                    writer.write(\"&#\");\n                    writer.write(code);\n                    writer.write(';');\n            }\n else \n{\n                    writer.write((char) code);\n            }\n\n            if (code > 0xffff) \n{\n                    i++;\n            }\n        }\n    }\nBesides fixing escapeXML(), this will also affect HTML escaping functions. I guess that's a good thing, but please remember I have only tested escapeXML().\n\n"
}